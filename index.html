<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard D3.js</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    /* ... estilos originales ... */
    body {{ background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }}
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="header">
      <h1>游늵 Dashboard Interactivo</h1>
      <p>Visualizaci칩n de datos con D3.js</p>
    </div>

    <div class="stats-grid" id="stats"></div>

    <div class="charts-grid">
      <!-- Gr치ficos existentes -->
      <div class="chart-container">
        <div class="chart-title">游늳 Ventas por Mes</div>
        <div id="barChart"></div>
      </div>
      <div class="chart-container">
        <div class="chart-title">游볺 Distribuci칩n por Categor칤a</div>
        <div id="pieChart"></div>
      </div>
      <div class="chart-container full-width">
        <div class="chart-title">游늵 Tendencia de Usuarios</div>
        <div id="lineChart"></div>
      </div>

      <!-- Gr치ficas de Colab insertadas aqu칤 -->
      <div class="chart-container full-width">
        <div class="chart-title">游꿢 Coordenadas del Mouse</div>
        <svg id="coords" width="300" height="300" style="background:lightgrey; border: 1px solid #ccc;"></svg>
      </div>

      <div class="chart-container full-width">
        <div class="chart-title">游 Doble Brush con Circulitos</div>
        <svg id="brush1" width="300" height="300" style="background:lightgrey"></svg>
        <svg id="brush2" width="300" height="300" style="background:lightgrey"></svg>
      </div>

      <div class="chart-container full-width">
        <div class="chart-title">游 Drag & Drop de C칤rculos</div>
        <svg id="dragdrop" width="600" height="200" style="background:lightgrey; border: 1px solid #ccc;">
          <circle cx="100" cy="100" r="20" fill="red"></circle>
          <circle cx="300" cy="100" r="20" fill="green"></circle>
          <circle cx="500" cy="100" r="20" fill="blue"></circle>
        </svg>
      </div>

      <div class="chart-container full-width">
        <div class="chart-title">游뚽 Gr치fica Stagger por Clic</div>
        <svg id="stagger" width="600" height="300" style="background:lightgrey"></svg>
      </div>

      <div class="chart-container">
        <div class="chart-title">游꿮 Lissajous en Tiempo Real</div>
        <svg id="lissajous" width="300" height="300" style="background:lightgrey"></svg>
      </div>
    </div>
  </div>

  <div class="tooltip" id="tooltip"></div>

  <script>
    // Aqu칤 van las funciones initDashboard, createBarChart, etc.
    // Y se agregan las de las nuevas gr치ficas:

    function coordsPixels(selector) {{
      var txt = d3.select(selector).append('text')
        .attr('font-family', 'Arial, sans-serif')
        .attr('font-size', '12px')
        .attr('fill', 'black');

      var svg = d3.select(selector)
        .attr('cursor', 'crosshair')
        .on('mousemove', function() {{
          var pt = d3.mouse(svg.node());
          txt.attr('x', 18 + pt[0]).attr('y', 6 + pt[1])
            .text('(' + Math.round(pt[0]) + ', ' + Math.round(pt[1]) + ')');
        }})
        .on('mouseleave', function() {{ txt.text(''); }});
    }}

    function makeBrush() {{
      const data = Array.from({{ length: 100 }}, () => {{
        return {{ A: Math.random() * 100, B: Math.random() * 100 }};
      }});
      const sc1 = d3.scaleLinear().domain([0, 10, 50]).range(["lime", "yellow", "red"]);
      const sc2 = d3.scaleLinear().domain([0, 10, 50]).range(["lime", "yellow", "blue"]);
      const svg1 = d3.select("#brush1"), svg2 = d3.select("#brush2");

      const cs1 = drawCircles(svg1, data, d => d.A * 3, d => d.B * 3, sc1);
      const cs2 = drawCircles(svg2, data, d => d.A * 3, d => d.B * 3, sc2);

      installHandlers(svg1, data, cs1, cs2, sc1, sc2);
    }}

    function drawCircles(svg, data, accX, accY, sc) {{
      var color = sc(Infinity);
      return svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("r", 5)
        .attr("cx", accX)
        .attr("cy", accY)
        .attr("fill", color)
        .attr("fill-opacity", 0.4);
    }}

    function installHandlers(svg, data, cs1, cs2, sc1, sc2) {{
      svg.attr("cursor", "crosshair")
        .on("mousemove", function(event) {{
          const pt = d3.pointer(event);
          cs1.attr("fill", function(d, i) {{
            const r = Math.hypot(pt[0] - +d3.select(this).attr("cx"), pt[1] - +d3.select(this).attr("cy"));
            data[i].r = r;
            return sc1(r);
          }});
          cs2.attr("fill", (d, i) => sc2(data[i].r));
        }})
        .on("mouseleave", function() {{
          cs1.attr("fill", sc1(Infinity));
          cs2.attr("fill", sc2(Infinity));
        }});
    }}

    function makeDragDrop() {{
      var widget = undefined, color = undefined;
      var drag = d3.drag()
        .on("start", function() {{
          color = d3.select(this).attr("fill");
          widget = d3.select(this).attr("fill", "lime");
        }})
        .on("drag", function() {{
          var pt = d3.mouse(d3.select("#dragdrop").node());
          widget.attr("cx", pt[0]).attr("cy", pt[1]);
        }})
        .on("end", function() {{
          widget.attr("fill", color);
          widget = undefined;
        }});
      drag(d3.select("#dragdrop").selectAll("circle"));
    }}

    function makeStagger() {{
      var ds1 = [2,1,3,5,7,8,9,9,9,8,7,5,3,1,2];
      var ds2 = [8,9,8,7,5,3,2,1,2,3,5,7,8,9,8];
      var n = ds1.length;
      var scX = d3.scaleLinear().domain([0,n]).range([50,540]);
      var scY = d3.scaleLinear().domain([0,9]).range([250,50]);
      var svg = d3.select("#stagger");
      svg.selectAll("line").data(ds1).enter().append("line")
        .attr("stroke", "red").attr("stroke-width", 20)
        .attr("x1", (d,i)=>scX(i)).attr("y1", scY(0))
        .attr("x2", (d,i)=>scX(i)).attr("y2", d=>scY(d));
      svg.on("click", function() {{
        [ds1, ds2] = [ds2, ds1];
        svg.selectAll("line").data(ds1)
          .transition().duration(1000).delay((d,i)=>200*i)
          .attr("y2", d=>scY(d));
      }});
    }}

    function makeLissajous() {{
      var svg = d3.select("#lissajous");
      var a = 1.9, b = 3.2;
      var phi, omega = 2 * Math.PI / 10000;
      var crrX = 150 + 100, crrY = 150;
      var prvX = crrX, prvY = crrY;
      var timer = d3.timer(function(t) {{
        phi = omega * t;
        crrX = 150 + 100 * Math.cos(a * phi);
        crrY = 150 + 100 * Math.sin(b * phi);
        svg.selectAll("line")
          .each(function() {{ this.bogus_opacity *= 0.99; }})
          .attr("stroke-opacity", function() {{ return this.bogus_opacity; }})
          .filter(function() {{ return this.bogus_opacity < 0.05; }})
          .remove();
        svg.append("line")
          .each(function() {{ this.bogus_opacity = 1.0; }})
          .attr("x1", prvX).attr("y1", prvY)
          .attr("x2", crrX).attr("y2", crrY)
          .attr("stroke", "green").attr("stroke-width", 2);
        prvX = crrX; prvY = crrY;
        if (t > 120000) timer.stop();
      }});
    }}

    function initDashboard() {
      createStatsCards();
      createBarChart();
      createPieChart();
      createLineChart();
      coordsPixels("#coords");
      makeBrush();
      makeDragDrop();
      makeStagger();
      makeLissajous();
    }

    document.addEventListener('DOMContentLoaded', initDashboard);
  </script>
</body>
</html>
